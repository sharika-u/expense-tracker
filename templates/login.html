<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <style>
        body { font-family: Arial; padding: 50px; background: #f5f5f5; text-align: center; }
        .box { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; font-size: 16px; }
        button:hover { background: #218838; }
        .back-btn { background: #6c757d; }
        .back-btn:hover { background: #545b62; }
        #status { margin: 15px 0; padding: 10px; border-radius: 5px; display: none; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        #register-form { display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h1>üí∞ Expense Tracker</h1>
        
        <!-- LOGIN FORM -->
        <div id="login-form">
            <div id="status"></div>
            <input id="username" placeholder="Username">
            <input id="password" type="password" placeholder="Password">
            <button onclick="loginUser()">Login</button>
            <p style="margin-top: 20px;"><strong>New user?</strong> <button onclick="showRegister()" style="background:none;border:none;color:#007bff;cursor:pointer;">Register Now</button></p>
        </div>
        
        <!-- REGISTER FORM -->
        <div id="register-form">
            <div id="status"></div>
            <input id="reg-username" placeholder="Choose Username">
            <input id="reg-password" type="password" placeholder="Choose Password">
            <button onclick="registerUser()">Create Account</button>
            <button class="back-btn" onclick="showLogin()">‚Üê Back to Login</button>
        </div>
    </div>

    <script>
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = isError ? 'error' : 'success';
            status.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        async function loginUser() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showStatus('Please enter username and password', true);
                return;
            }

            showStatus('Logging in...');
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = '/dashboard';
                } else {
                    showStatus(data.error || 'Login failed', true);
                }
            } catch (error) {
                showStatus('Network error - check server', true);
                console.error('Login error:', error);
            }
        }

        async function registerUser() {
            console.log('üî• CREATE ACCOUNT CLICKED!');
            
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            
            console.log('Data:', username, password);
            
            if (!username || !password) {
                showStatus('Please enter username and password', true);
                return;
            }

            showStatus('Creating your account...');
            
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    showStatus('Account created! Redirecting...');
                    setTimeout(() => window.location.href = '/dashboard', 1000);
                } else {
                    showStatus(data.error || 'Registration failed', true);
                }
            } catch (error) {
                showStatus('Server error - try again', true);
                console.error('Register error:', error);
            }
        }

        function showRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            hideStatus();
        }

        function showLogin() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
            hideStatus();
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('register-form').style.display === 'block') {
                    registerUser();
                } else {
                    loginUser();
                }
            }
        });
    </script>
</body>
</html>
